#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Run pre-commit quality gates
echo "ğŸ” Running pre-commit quality gates..."

# Frontend checks
echo "ğŸ“± Running frontend checks..."
npx lint-staged

# Backend checks
echo "ğŸ¦€ Running backend checks..."
cd src-tauri

# Rust formatting check
echo "  âœ¨ Checking Rust formatting..."
cargo fmt --check || {
  echo "âŒ Rust code is not formatted. Run 'cargo fmt' to fix."
  exit 1
}

# Rust linting
echo "  ğŸ” Running Rust linting..."
cargo clippy -- -D warnings || {
  echo "âŒ Rust linting failed. Fix clippy warnings."
  exit 1
}

# Rust type checking
echo "  ğŸ”§ Running Rust type checking..."
cargo check || {
  echo "âŒ Rust type checking failed."
  exit 1
}

# Rust tests
echo "  ğŸ§ª Running Rust tests..."
cargo test || {
  echo "âŒ Rust tests failed."
  exit 1
}

cd ..

echo "âœ… All pre-commit checks passed!"
